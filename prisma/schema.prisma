generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

/// AI development milestone entity
model Milestone {
  id                   String   @id @default(cuid())
  title                String
  description          String
  date                 DateTime
  category             String
  significance         Int
  era                  String?
  organization         String?
  contributors         String   @default("[]")
  sourceUrl            String?
  imageUrl             String?
  tags                 String   @default("[]")
  sources              String   @default("[]")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  businessImpact       String?
  commonMisconceptions String?
  historicalContext    String?
  simpleExplanation    String?
  technicalDepth       String?
  tldr                 String?
  whyItMattersToday    String?

  @@index([date])
  @@index([category])
  @@index([era])
}

/// News source for automated ingestion
model NewsSource {
  id             String            @id @default(cuid())
  name           String
  url            String            @unique
  feedUrl        String
  isActive       Boolean           @default(true)
  checkFrequency Int               @default(60)
  lastCheckedAt  DateTime?
  createdAt      DateTime          @default(now())
  articles       IngestedArticle[]
}

/// Article ingested from a news source
model IngestedArticle {
  id             String      @id @default(cuid())
  sourceId       String
  source         NewsSource  @relation(fields: [sourceId], references: [id], onDelete: Cascade)
  externalUrl    String      @unique
  title          String
  content        String
  publishedAt    DateTime
  ingestedAt     DateTime    @default(now())

  // Stage 1 Analysis Results (Sprint 30)
  analysisStatus    String      @default("pending") // pending, screening, generating, complete, error
  analyzedAt        DateTime?
  relevanceScore    Float?      // 0-1 scale
  isMilestoneWorthy Boolean     @default(false)
  milestoneRationale String?    // Why/why not milestone-worthy
  analysisError     String?

  // Review fields (Sprint 31)
  reviewStatus   String      @default("pending")

  // Relations
  drafts         ContentDraft[]

  @@index([sourceId])
  @@index([publishedAt])
  @@index([analysisStatus])
  @@index([isMilestoneWorthy])
}

/// AI-generated content draft awaiting review
model ContentDraft {
  id               String           @id @default(cuid())
  articleId        String
  article          IngestedArticle  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  contentType      String           // "news_event" | "milestone" | "glossary_term"
  draftData        String           // JSON matching target schema

  // Validation
  isValid          Boolean          @default(false)
  validationErrors String?          // JSON array of validation errors

  // Review status
  status           String           @default("pending") // pending, approved, rejected, published
  rejectionReason  String?

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  publishedAt      DateTime?
  publishedId      String?          // ID of published milestone/event/term

  @@index([articleId])
  @@index([contentType])
  @@index([status])
}
